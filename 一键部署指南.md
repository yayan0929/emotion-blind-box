# 一键部署指南

## 步骤1：部署后端到Render

1. 访问 [Render](https://render.com/)
2. 使用GitHub账号登录
3. 点击 "New +" 按钮
4. 选择 "Web Service"
5. 选择 "Build and deploy from a Git repository"
6. 连接您的GitHub仓库（如果尚未推送代码，请先创建仓库并推送）
7. 配置部署设置：
   - Name: `emotion-blind-box-api`
   - Root Directory: `server`
   - Build Command: `npm install`
   - Start Command: `npm start`
8. 添加环境变量：
   - `NODE_ENV`: `production`
   - `PORT`: `3001`
   - `JWT_SECRET`: [点击生成按钮]
   - `JWT_REFRESH_SECRET`: [点击生成按钮]
   - `JWT_EXPIRES_IN`: `15m`
   - `JWT_REFRESH_EXPIRES_IN`: `7d`
9. 点击 "Create Web Service"
10. 等待部署完成，获取后端API URL（例如：https://emotion-blind-box-api.onrender.com）

## 步骤2：部署数据库到Render

1. 点击 "New +" 按钮
2. 选择 "PostgreSQL"
3. 配置数据库设置：
   - Name: `emotion-blind-box-db`
   - Database Name: `emotion_blind_box`
   - User: `admin`
4. 点击 "Create Database"
5. 等待数据库创建完成
6. 获取数据库连接字符串（Internal Database URL）
7. 回到后端服务，添加环境变量：
   - `DATABASE_URL`: [粘贴数据库连接字符串]
8. 点击 "Save Changes" 触发重新部署

## 步骤3：初始化数据库

1. 在后端服务部署完成后，访问API文档或使用以下命令初始化数据库：
   ```
   curl https://your-api-url.onrender.com/api/prisma/migrate
   ```

## 步骤4：部署前端到Netlify

1. 运行部署脚本：
   ```
   双击 "部署到Netlify.bat" 文件
   ```
2. 或手动执行：
   ```
   cd netlify-dist
   netlify deploy --prod --dir .
   ```

3. 访问 [Netlify Drop](https://app.netlify.com/drop)
4. 将 `netlify-dist` 文件夹中的所有文件拖拽到页面中
5. 等待部署完成，获取前端URL

## 步骤5：配置CORS（如果需要）

如果前端无法访问后端API，请在后端代码中添加CORS配置：

```javascript
// 在 server/src/index.ts 或类似文件中添加
app.use(cors({
  origin: ['https://your-frontend-url.netlify.app', 'http://localhost:5173'],
  credentials: true
}));
```

## 完成后

1. 访问您的Netlify网站
2. 测试注册和登录功能
3. 确保所有API请求都能正常工作

## 故障排除

1. **前端无法访问后端**：
   - 检查CORS配置
   - 确认API地址正确
   - 检查环境变量是否设置正确

2. **数据库连接失败**：
   - 检查数据库连接字符串
   - 确认数据库已启动
   - 检查数据库用户权限

3. **认证失败**：
   - 检查JWT密钥
   - 确认JWT环境变量设置正确

## 一键部署脚本

运行以下脚本可以自动完成部分配置：

1. **后端部署脚本**：`部署到Render.bat`
2. **前端部署脚本**：`部署到Netlify.bat`

注意：您仍然需要手动配置一些设置，如环境变量和数据库连接。